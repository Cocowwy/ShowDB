<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ShowDB</title>
    <!--Áõ∏ÂÖ≥ÂºïÂÖ•-->
    <link rel="shortcut icon" th:href="@{img/database.png}">
    <script th:src="@{js/vue.min.js}"></script>
    <script th:src="@{js/axios.min.js}"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" th:href="@{css/db.css}">
</head>
<body>
<dev id="ShowDB">
    <!--È°∂ÈÉ®laery-->
    <el-alert style="font-weight: bold" v-if="customize!=null"
              :title="customize.topAlert"
              type="success"
              @close="starIt" center>
    </el-alert>

    <el-container>
        <el-aside width="20%">
            <!--customize-->
            <el-card :body-style="{ padding: '0px' }" style="width: 75%;margin-left: 15%;margin-top: 10%">
                <img v-if="customize!=null" :src="customize.img" class="image" style="width: 100%;display: block;">
                <div style="padding: 14px;">
                    <span style="font-size: large">üë§  {{customize.creator}}</span><br>
                    <span style="font-size: large">üìÆ  {{customize.email}}</span><br>
                    <span style="font-size: large">üóí  {{customize.desc}}</span><br>
                </div>
            </el-card>
        </el-aside>

        <!--Ë°®ÁªìÊûÑ‰ø°ÊÅØ-->
        <el-main v-loading="loadingTables" width="48%" style="margin: 10px">
            <div v-loading="loadingDataSource">
                <el-radio v-model="currentDataSource" @change="dsChange" v-for="(item,index) in dataSorucesInfo"
                          :label="item.beanName" border>{{item.beanName}}
                </el-radio>
            </div>

            <div style="margin-top: 18px">
                <el-popconfirm title="Êï∞ÊçÆÂ∫ìÁªìÊûÑÂèëÁîüÂèòÂåñÈúÄÊâãÂä®Ê∏ÖÁêÜÁºìÂ≠òÔºü" @confirm="cleanCache">
                    <el-button icon="el-icon-delete" type="info" slot="reference">Ê∏ÖÁêÜÁºìÂ≠ò</el-button>
                </el-popconfirm>
                <el-popconfirm title="ÊòØÂê¶ÁîüÊàêÂΩìÂâçÊï∞ÊçÆÊ∫êÊâÄÊúâË°®ÁªìÊûÑÊñáÊ°£Ôºü" @confirm="dsTableDoc">
                    <el-button icon="el-icon-document" type="primary" slot="reference">Ë°®ÁªìÊûÑÊñáÊ°£ÂØºÂá∫</el-button>
                </el-popconfirm>
                <el-popconfirm title="ÊòØÂê¶ÂØºÂá∫ÂΩìÂâçÊï∞ÊçÆÊ∫êÊâÄÊúâË°®SQLÂàõÂª∫ËØ≠Âè•Ôºü" @confirm="dbCreateStatement">
                    <el-button icon="el-icon-document" type="primary" slot="reference">Âª∫Ë°®ËØ≠Âè•ÂØºÂá∫</el-button>
                </el-popconfirm>
                <el-button icon="el-icon-document" type="primary" slot="reference" @click="trxInfo">Êü•ÁúãDB‰∫ãÂä°</el-button>
                <el-tooltip class="item" effect="dark" content="star~" placement="bottom">
                    <el-button style="background-color: #1d2009;border-color: black;color: white;"
                               type="primary" icon="el-icon-star-on" size="x-large" @click="starIt">star
                    </el-button>
                </el-tooltip>

            </div>

            <div style="display: flex;align-items: center">
                <el-autocomplete size="large"
                                 v-model="queryTableName"
                                 :fetch-suggestions="querySearch"
                                 placeholder="Ë°®ÂêçÊ®°Á≥äÊü•ËØ¢ÔºåÂõûËΩ¶Á°ÆËÆ§"
                                 select-when-unmatched="true"
                                 prefix-icon="el-icon-search"
                                 @select="handleSelect" style="margin-top: 18px;width: 30%;">
                    <template slot-scope="{ item }">
                        <div class="name">{{ item}}</div>
                    </template>
                </el-autocomplete>
            </div>


            <el-card v-for="(item,index) in  tableStruct" class="box-card" style="margin-top: 18px" shadow="hover">
                <div slot="header" class="clearfix">
                    <span style="font-weight: bolder">{{item.tableInfo.tableName}}&nbsp{{item.tableInfo.tableComment}}</span>
                    <el-button style="font-size: 18px;float: right; padding: 3px 3px" type="text"
                               @click="tableJavaCode(item.tableInfo.tableName)">JavaÂÆû‰ΩìÁ±ª
                    </el-button>
                    <el-button style="font-size: 18px;float: right; padding: 3px 3px" type="text"
                               @click="tableCreateStatement(item.tableInfo.tableName)">Âª∫Ë°®ËØ≠Âè•
                    </el-button>
                    <el-button style="font-size: 18px;float: right; padding: 3px 0px" type="text"
                               @click="tableDetailInfo(item.tableInfo.tableName)">ËØ¶ÁªÜ‰ø°ÊÅØ
                    </el-button>
                </div>
                <div>
                    <el-table :data="item.tableFieldList" stripe style="width: 100%;font-size: medium">
                        <el-table-column property="fieldName" label="Â≠óÊÆµ">
                            <template slot-scope="scope">
                                <span style="display: flex;align-items: center">
                                    <span>{{ scope.row.fieldName }}</span>
                                        <el-image v-if="scope.row.pk"
                                                  style="width: 26px; height: 26px"
                                                  th:src="@{img/pk.png}"></el-image>
                                </span>
                            </template>
                        </el-table-column>
                        <el-table-column property="type" label="Á±ªÂûã"></el-table-column>
                        <el-table-column property="comment" label="Â≠óÊÆµÊèèËø∞"></el-table-column>
                        <el-table-column property="nullable" label="‰∏ç‰∏∫Á©∫">
                            <template slot-scope="scope">
                            <span style="display: flex;align-items: center">
                                        <el-image v-if="!scope.row.nullable"
                                                  style="width: 26px; height: 26px"
                                                  th:src="@{img/isTrue.png}"></el-image>
                                </span>
                            </template>
                        </el-table-column>
                        <el-table-column property="columnDefault" label="ÈªòËÆ§ÂÄº"></el-table-column>
                    </el-table>
                </div>
            </el-card>

            <!--ÂàÜÈ°µ-->
            <div class="block" style="margin-top: 30px;text-align: center">
                <el-pagination
                        @current-change="handleCurrentChange"
                        :current-page.sync="tableStructPageNumber"
                        :page-size="tableStructSize"
                        layout="prev, pager, next, jumper"
                        :total="total">
                </el-pagination>
            </div>
        </el-main>

        <!--Âè≥‰æßÊï∞ÊçÆÊ∫ê-->
        <el-aside width="28%" style="margin-top: 10px;margin-left: 10px">
            <el-card style="width:80%;overflow-x: auto" class="box-card"
                     v-if="currentDataSourceInfo!=null" shadow="hover">
                <el-descriptions direction="vertical" :column="1" border v-if="currentDataSourceInfo!=null"
                                 shadow="hover"
                                 :title="currentDataSourceInfo.beanName">
                    <el-descriptions-item label="Êï∞ÊçÆÂ∫ìÁ±ªÂûã">
                        <el-tag size="large" type="info">{{currentDataSourceInfo.dsProductName}}</el-tag>
                    </el-descriptions-item>
                    <el-descriptions-item label="Êï∞ÊçÆÂ∫ìÁâàÊú¨Âè∑">
                        <el-tag size="large" type="success"> {{currentDataSourceInfo.dbVersion}}</el-tag>
                    </el-descriptions-item>
                    <el-descriptions-item label="Êï∞ÊçÆÂ∫ì">
                        <div style="color:black;font-weight:bold;font-size: large">
                            {{currentDataSourceInfo.tableSchema}}
                        </div>
                    </el-descriptions-item>
                    <el-descriptions-item label="Êìç‰ΩúÁ≥ªÁªü">{{currentDataSourceInfo.osEnv}}</el-descriptions-item>
                    <el-descriptions-item label="ËøûÊé•Áî®Êà∑">{{currentDataSourceInfo.username}}</el-descriptions-item>
                    <el-descriptions-item label="ÊÄªËÆ∞ÂΩïÊï∞">{{currentDataSourceInfo.records}} Ë°å</el-descriptions-item>
                    <el-descriptions-item label="ÊÄªÊï∞ÊçÆÈáè">{{currentDataSourceInfo.dataSize}}MB</el-descriptions-item>
                    <el-descriptions-item label="ÊÄªÁ¥¢ÂºïÈáè">{{currentDataSourceInfo.indexSize}}MB</el-descriptions-item>
                    <el-descriptions-item label="Ë∑ØÂæÑ">{{currentDataSourceInfo.baseDir}}</el-descriptions-item>
                    <el-descriptions-item label="ËøûÊé•URL">
                        <el-button :plain="true" @click="showDsUrl(currentDataSourceInfo.url)">ÁÇπÂáªÊü•ÁúãURL</el-button>
                    </el-descriptions-item>
                </el-descriptions>
            </el-card>

            <!--IPÂÆ¢Êà∑Á´Ø‰ø°ÊÅØ-->
            <el-card style="margin-top: 12px;width:80%" class="box-card"
                     v-if="ipConInfo!=null" shadow="hover">
                <div slot="header" class="clearfix">
                    <span style="font-size: 32px;font-weight: 700;">ÂÆ¢Êà∑Á´ØËøûÊé•‰ø°ÊÅØ</span>
                </div>
                <el-table :data="ipConInfo" border>
                    <el-table-column prop="ip" label="IP"></el-table-column>
                    <el-table-column prop="count" label="ËøûÊé•Êï∞Èáè"></el-table-column>
                </el-table>
            </el-card>


            <!--‰∏ª‰ªé‰ø°ÊÅØ  IDEAÁöÑÈ£òÁ∫¢‰∏çÁÆ°-->
            <el-card style="margin-top: 12px;width:80%" class="box-card"
                     v-if="currentDataSourceMasterSlaveInfo==null"
                     shadow="hover">
                <el-empty th:image="@{img/masterSlave.png}"
                          description="ÊöÇÊú™Ê£ÄÊµãÂà∞ÂΩìÂâçÊï∞ÊçÆÊ∫êÂ≠òÂú®‰∏ª‰ªé‰ø°ÊÅØ">
                </el-empty>
            </el-card>
            <el-card style="margin-top: 12px;width:80%" class="box-card"
                     v-if="currentDataSourceMasterSlaveInfo"
                     shadow="hover">
                <div>
                    <el-descriptions title="‰∏ª‰ªé‰ø°ÊÅØ" direction="vertical" :column="1" border>
                        <el-descriptions-item label="‰∏ªÊú∫IPÔºàMaster_HostÔºâ">
                            {{currentDataSourceMasterSlaveInfo.masterHost}}
                        </el-descriptions-item>
                        <el-descriptions-item label="‰∏ª‰ªéÂ§çÂà∂Áî®Êà∑ÔºàMaster_UserÔºâ">
                            {{currentDataSourceMasterSlaveInfo.masterUser}}
                        </el-descriptions-item>
                        <el-descriptions-item label="‰∏ªÊú∫Á´ØÂè£ÔºàMaster_PortÔºâ">
                            {{currentDataSourceMasterSlaveInfo.masterPort}}
                        </el-descriptions-item>
                        <el-descriptions-item label="‰ªéÂ∫ìÊªûÂêéÊó∂ÈïøÔºàSQL_DelayÔºâÔºåÂçï‰ΩçÔºöÁßí">
                            <div style="color:#8de013;font-weight:bold;font-size: large"
                                 v-if="currentDataSourceMasterSlaveInfo.sqlDelay==0">
                                {{currentDataSourceMasterSlaveInfo.sqlDelay}}
                            </div>
                            <div style="color:red;font-weight:bold;font-size: large"
                                 v-if="currentDataSourceMasterSlaveInfo.sqlDelay!=0">
                                {{currentDataSourceMasterSlaveInfo.sqlDelay}}
                            </div>
                        </el-descriptions-item>
                        <el-descriptions-item label="ËøûÊé•‰∏ªÂ∫ìÂ§±Ë¥•ÊúÄÂ§öÁöÑÈáçËØïÊ¨°Êï∞ÔºàMaster_Retry_CountÔºâ">
                            {{currentDataSourceMasterSlaveInfo.masterRetryCount}}
                        </el-descriptions-item>
                        <el-descriptions-item label="slave I/OÁ∫øÁ®ãÁä∂ÊÄÅÔºàSlave_IO_StateÔºâ">
                            <div style="color:black;font-weight:bold;font-size: large">
                                {{currentDataSourceMasterSlaveInfo.slaveIOState}}
                            </div>
                        </el-descriptions-item>
                        <el-descriptions-item label="Slave_IO_Running">
                            <div style="color:#8de013;font-weight:bold;font-size: large"
                                 v-if="currentDataSourceMasterSlaveInfo.slaveIORunning=='Yes'">
                                {{currentDataSourceMasterSlaveInfo.slaveIORunning}}
                            </div>
                            <div style="color:red;font-weight:bold;font-size: large"
                                 v-if="currentDataSourceMasterSlaveInfo.slaveIORunning!='Yes'">
                                {{currentDataSourceMasterSlaveInfo.slaveIORunning}}
                            </div>
                        </el-descriptions-item>
                        <el-descriptions-item label="Slave_SQL_Running">
                            <div style="color:#8de013;font-weight:bold;font-size: large"
                                 v-if="currentDataSourceMasterSlaveInfo.slaveSQLRunning=='Yes'">
                                {{currentDataSourceMasterSlaveInfo.slaveSQLRunning}}
                            </div>
                            <div style="color:red;font-weight:bold;font-size: large"
                                 v-if="currentDataSourceMasterSlaveInfo.slaveSQLRunning!='Yes'">
                                {{currentDataSourceMasterSlaveInfo.slaveSQLRunning}}
                            </div>
                        </el-descriptions-item>
                        <el-descriptions-item label="Relay_Log_File">{{currentDataSourceMasterSlaveInfo.relayLogFile}}
                        </el-descriptions-item>
                        <el-descriptions-item label="Master_Log_File">
                            {{currentDataSourceMasterSlaveInfo.masterLogFile}}
                        </el-descriptions-item>
                    </el-descriptions>
                </div>
            </el-card>
        </el-aside>
    </el-container>


    <!--Ë°®ÂàõÂª∫ËØ≠Âè•ÂºπÊ°Ü-->
    <el-dialog
            :title="createStatementTableName"
            :visible.sync="createStatementDialog"
            width="38%">
        <el-input
                type="textarea"
                :autosize="{ minRows: 2, maxRows: 20}"
                v-model="createStatementContent">
        </el-input>
        <span slot="footer" class="dialog-footer">
    <el-button type="primary" @click="createStatementDialog = false">Á°Æ ÂÆö</el-button>
  </span>
    </el-dialog>

    <!--JavaÂÆû‰ΩìÁ±ª‰ª£Á†Å-->
    <el-dialog
            :title="createJavaCodeTableName"
            :visible.sync="createJavaCodeDialog"
            width="38%">
        <el-input
                type="textarea"
                :autosize="{ minRows: 2, maxRows: 20}"
                v-model="createJavaCodeContent">
        </el-input>
        <span slot="footer" class="dialog-footer">
    <el-button type="primary" @click="createJavaCodeDialog = false">Á°Æ ÂÆö</el-button>
  </span>
    </el-dialog>

    <!--Ë°® ËØ¶ÁªÜ‰ø°ÊÅØ-->
    <el-dialog :title="tableDetailTableName" :visible.sync="tableDetailDialog" width="38%">
        <el-descriptions v-if="tableDetailInformation!=null">ÁâàÊú¨Âè∑
            <el-descriptions-item label="Ë°®ÊèèËø∞">{{tableDetailInformation.tableInfo.tableComment}}</el-descriptions-item>
            <el-descriptions-item label="Ë°åÊï∞">{{tableDetailInformation.tableInfo.rows}}</el-descriptions-item>
            <el-descriptions-item label="Êï∞ÊçÆÂ§ßÂ∞è">{{(tableDetailInformation.tableInfo.dataSize / 1024 /
                1024).toFixed(2)}}MB
                /
                {{tableDetailInformation.tableInfo.dataSize}}B
            </el-descriptions-item>
            <el-descriptions-item label="Á¥¢ÂºïÂ§ßÂ∞è">{{(tableDetailInformation.tableInfo.indexSie / 1024 /
                1024).toFixed(2)}}MB
                /
                {{tableDetailInformation.tableInfo.indexSie}}B
            </el-descriptions-item>
            <el-descriptions-item label="Âπ≥ÂùáÊØèË°åÂ≠óËäÇÊï∞">{{tableDetailInformation.tableInfo.avgRowLength}}B
            </el-descriptions-item>
            <el-descriptions-item v-if="tableDetailInformation.tableInfo.maxDataLenth===0" label="ÊúÄÂ§ßÂÆπÈáè">
                {{(tableDetailInformation.tableInfo.maxDataLenth / 1024 / 1024).toFixed(2)}}MB /
                {{tableDetailInformation.tableInfo.maxDataLenth}}B
            </el-descriptions-item>
            <el-descriptions-item v-else label="ÊúÄÂ§ßÂÆπÈáè">Êó†‰∏äÈôê</el-descriptions-item>

            <el-descriptions-item label="Â≠òÂÇ®ÂºïÊìé">{{tableDetailInformation.tableInfo.engine}}</el-descriptions-item>
            <el-descriptions-item label="Â≠óÁ¨¶ÈõÜ">{{tableDetailInformation.tableInfo.collation}}</el-descriptions-item>
            <el-descriptions-item label="ÂàõÂª∫Êó∂Èó¥">{{tableDetailInformation.tableInfo.createTime}}</el-descriptions-item>
            <el-descriptions-item label="Êõ¥Êñ∞Êó∂Èó¥">{{tableDetailInformation.tableInfo.updateTime}}</el-descriptions-item>
        </el-descriptions>
        <span slot="footer" style="text" class="dialog-footer">
    <el-button type="primary" @click="tableDetailDialog = false">Á°Æ ÂÆö</el-button>
  </span>
    </el-dialog>

    <!--Êï∞ÊçÆÊ∫ê‰∫ãÂä°-->
    <el-dialog title="‰∫ãÂä°ËØ¶ÊÉÖ" :visible.sync="transDialogTableVisible">
        <el-table :data="trxInfos">
            <el-table-column property="trx_id" label="trxId" width="150"></el-table-column>
            <el-table-column property="trx_state" label="trxState" width="150"></el-table-column>
            <el-table-column property="trx_started" label="trxStarted" width="150"></el-table-column>
            <el-table-column property="trx_requested_lock_id" label="trxRequestedLockId" width="150"></el-table-column>
            <el-table-column property="trx_wait_started" label="trxWaitStarted" width="150"></el-table-column>
            <el-table-column property="trx_weight" label="trxWeight" width="150"></el-table-column>
            <el-table-column property="trx_mysql_thread_id" label="trxMysqlThreadId" width="150"></el-table-column>
            <el-table-column property="trx_query" label="trxQuery" width="150"></el-table-column>
            <el-table-column property="trx_operation_state" label="trxOperationState" width="150"></el-table-column>
            <el-table-column property="trx_tables_in_use" label="trxTablesInUse" width="150"></el-table-column>
            <el-table-column property="trx_tables_locked" label="trxTablesLocked" width="150"></el-table-column>
            <el-table-column property="trx_lock_structs" label="trxLockStructs" width="150"></el-table-column>
            <el-table-column property="trx_lock_memory_bytes" label="trxLockMemoryBytes" width="150"></el-table-column>
            <el-table-column property="trx_rows_locked" label="trxRowsLocked" width="150"></el-table-column>
            <el-table-column property="trx_rows_modified" label="trxRowsModified" width="150"></el-table-column>
            <el-table-column property="trx_concurrency_tickets" label="trxConcurrencyTickets"
                             width="150"></el-table-column>
            <el-table-column property="trx_isolation_level" label="trxIsolationLevel" width="150"></el-table-column>
            <el-table-column property="trx_unique_checks" label="trxUniqueChecks" width="150"></el-table-column>
            <el-table-column property="trx_foreign_key_checks" label="trxForeignKeyChecks"
                             width="150"></el-table-column>
            <el-table-column property="trx_last_foreign_key_error" label="trxLastForeignKeyError"
                             width="150"></el-table-column>
            <el-table-column property="trx_adaptive_hash_latched" label="trxAdaptiveHashLatched"
                             width="150"></el-table-column>
            <el-table-column property="trx_adaptive_hash_timeout" label="trxAdaptiveHashTimeout"
                             width="150"></el-table-column>
            <el-table-column property="trx_is_read_only" label="trxIsReadOnly" width="150"></el-table-column>
            <el-table-column property="trx_autocommit_non_locking" label="trxAutocommitNonLocking"
                             width="150"></el-table-column>
        </el-table>
    </el-dialog>
</dev>

</body>
<script th:src="@{js/db.js}"></script>
</html>